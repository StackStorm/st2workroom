#!/usr/bin/env bash
set -e

DIR=$( dirname "$(readlink -f "$0")" )
. $DIR/shared-functions

init-bootstrap-os() {
    local _os_family_preflight_script="$(project-root)/script/bootstrap-os-$(os-family)"
    local _lock_file=$(installer-bootstrap-lock-file)

    if ! is-root; then
        show-help
        fail-loudly "Please run with root permissions"
    fi

    if file-exists $_os_family_preflight_script && ! file-exists $_lock_file; then
        execute-string $_os_family_preflight_script
        #ensure-file-exists $_lock_file
    else
        log "Lock file ${_lock_file} exists. Skipping bootstrap-os-$(os-family)"
    fi
}

init-bootstrap-os
